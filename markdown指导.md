[TOC]
<div STYLE="page-break-after: always;"></div>
#  1. 基础驱动程序库

## 1.1 基础驱动程序库

嵌入式系统中==参考链接==这样表示，[硬件][hardware]与软件是一个有机的结合体，也是任何嵌入式[硬件][hardware]中最重要的组成部分之一，底层驱动程序的可靠性直接影响到系统的运行效率和稳定性，==普通链接==这样表示[百度链接地址](https://www.jianshu.com/u/32ab4b968e34 "这是一个提示")，程序员不必关注底层硬件的寄存器及其操作，==直接链接==：<https://www.jianshu.com/u/32ab4b968e34>，==邮箱==直接表示 nielifei.cn@gmail.com。

[hardware]: https://www.google.com/  "Google"

LPC2300[^1] ==脚注==系列 ARM（LPC2364/2366/2368/2378）是NXP半导体最新推出的ARM7内核微控制器，专为工业通信连接而设计，其内部具有非常丰富的外设，包括多路UART、多路CAN2.0B控制器、USB控制器、SSP、定时器等等，同时每种[硬件][hardware]外设又具有很多灵活实用的功能，使其很容易嵌入各种工业应用场合，但功能丰富的同时也带来了系统开发尤其是驱动开发的复杂。

[^1]:LPC2300是NXP一款芯片

为了有效帮助工程师减少产品开发“0”阶段的时间，这里提供一种基于API方式操作底层硬件的开发方法。通过对LPC2300系列ARM片内外设寄存器的封装，生成一套用于LPC2300系列ARM的底层驱动库。

使用LPC2300==表格==开发，设计人员只需要调用API接口函数即可使用各种外设，无需理会其寄存器有多么复杂。通过封装的API函数，大大减少了与片内设备通信时所需的代码量。维护工作变得简单，驱动库使用了风格尽量统一的函数接口，使得程序的可移植性也大大提高。

|          | 使用驱动库 | 自行开发驱动 |
| -------- | ---------- | ------------ |
| 开发周期 | 短         | 长           |
| 代码量   | 小         | 大           |
| 维护工作 | 简单       | 复杂         |
| 移植     | 方便       | 难度大       |
| 开发难度 | 低         | 高           |

### 1.1.1 概述

ZLG/Driver2300驱动函数库配合LPC2300系列ARM使用，为用户提供了大部分片内外设的底层硬件驱动程序，但不包括USB、SD接口等，支持的常用部件如表1.2所示。

|      | 外设名称   | 说明                                                         |
| ---: | ---------- | ------------------------------------------------------------ |
|    1 | GPIO       | 支持全部P0、P1、P2、P3、P4端口，支持高速GPIO或低速GPIO操作。 |
|    2 | 中断控制器 | 在特权模式统一管理中断，提供FIQ、IRQ的所有中断设置接口       |
|    3 | 定时器     | 提供定时、计数、捕获外部事件、匹配输出等功能，当事件发生时均可以对是否产生中断、复位或停止TC等操作进行组合配置 |
|    4 | PWM        | 6路单边沿或3路双边沿PWM波输出，PWM控制器可作为定时器使用     |

另外，USB、SD接口等提供专门的软件包支持。使用驱动库函数，工程师不必关心硬件细节，只要懂C语言就可直接通过API函数操作LPC2300系列ARM开发产品，下面是==注解==。

>   本函数库可在LPC2300系列ARM的多种开发平台上使用，本章示范例程以SmartARM2300开发板为平台（MiniARM M23A模块）进行测试。暂时不支持其它硬件平台的应用，后续版本将对不同平台进行测试以解决平台兼容问题

### 1.1.2 特性

开发高效率、性能稳定的驱动程序，不仅要求工程师具有良好的程序编写水平，同时还要求对底层硬件接口技术非常熟悉。在面对一大堆的寄存器说明时，往往使很多平时专注于应用程序开发的工程师对于嵌入式系统望而却步。即使是有过底层开发经验的程序员，也往往希望能够有更轻松的开发方式出现，以减少其浪费在驱动程序编写上的时间==无序列表==。

-   标准C语言编程；

-   统一、简洁的系统硬件标准操作函数接口，使用Init()、SetMode()、Read()、Write()、Start()、Stop()完成各个外设的功能操作；

-   简单、清晰的VIC和引脚管理方式；

-   字符串参数处理

### 1.1.3  函数接口

使用ZLG/Driver2300驱动库开发产品时，程序员不必关注底层硬件的寄存器及其操作，直接在应用层调用API驱动函数即可使用UART、I²C等外设接口。
1. **设备区分**

对于相同的设备，如UART0、UART1，使用统一的函数接口，通过使用不同的ID号区分。在使用ID区分设备时，首先必须对相应设备进行宏定义（本驱动库已经完成），其例程如==代码==清单1.1所示。

```c
//初始化字符串参数，未写出的参数为默认值或无效
char UartArg[66] = "BaudRate=9600 RxBufSize=50 TxBufSize=50";

//初始化UART0								
UartInit(UART0, UartArg, NULL);			
```
2．**参数设置**

设备参数使用字符串方式传入，可以选择只输入部分参数，这时未输入的参数将被设置为默认值或被忽略。在书写字符串内容时候，必须特别注意其格式，非法的格式将被滤除，==上标==O<sup>2</sup>，==下标==H<sub>2</sub>O，也可以改变字体的颜色$ \color{green}{绿色}$。

- 字符串条目采用“关键字=数值”的格式；
- 条目作为一个基本的参数单数，内部不允许再包含空格等其他任何非法字符；
- 每个条目之间使用空格区分；
- 参数值支持十进制、十六进制（0xMN）、八进制（0MN），不能使用宏定义；
- 条目之间可用连接符“＼”实现跨行书写。

3. **添加图片**

除GPIO与VIC以外，添加的==图片==驱动库尽量使用统一的函数接口来操作底层硬件，所有设备均使用对应的Init()操作完成初始化工作，如TimerInit()、SspInit()、UartInit()等，初始化函数说明如表1.3所示，还可以添加==高亮的文字==，也可以添加==表情==:smile:。

![这是我添加的图片](/picture.png "这是图片提示信息")

4.  **添加分割线**

嵌入式系统中硬件与软件是一个有机的结合体，驱动程序是软硬件协调的交点，也是任何嵌入式系统中最重要的组成部分之一，底层驱动程序的可靠性直接影响到系统的运行效率和稳定性，==分割线==如下所示：

---

嵌入式系统中硬件与软件是一个有机的结合体，驱动程序是软硬件协调的交点，也是**粗体**任何嵌入式系统中最重要的组成部分之一，底层驱动程序的==删除线==直接~~影响到~~系统的运行效率和稳定性，或者面临==下划线==的<u>表示</u>。

也可以添加完成==任务完成结果==，如下面的表示。

-   [ ] 吃饭

-   [x] 睡觉

-   [ ] 上厕所

==代码高亮提示==: `npm install marked`

<div STYLE="page-break-after: always;"></div>
#  2. 基础驱动程序库

## 2.1 基础驱动程序库

嵌入式系统中==参考链接==这样表示，[硬件][hardware]与软件是一个有机的结合体，也是任何嵌入式[硬件][hardware]中最重要的组成部分之一，底层驱动程序的可靠性直接影响到系统的运行效率和稳定性，==普通链接==这样表示[百度链接地址](https://www.jianshu.com/u/32ab4b968e34 "这是一个提示")，程序员不必关注底层硬件的寄存器及其操作，==直接链接==：<https://www.jianshu.com/u/32ab4b968e34>，==邮箱==直接表示 nielifei.cn@gmail.com。

[hardware]: https://www.google.com/  "Google"

LPC2300[^1] ==脚注==系列 ARM（LPC2364/2366/2368/2378）是NXP半导体最新推出的ARM7内核微控制器，专为工业通信连接而设计，其内部具有非常丰富的外设，包括多路UART、多路CAN2.0B控制器、USB控制器、SSP、定时器等等，同时每种[硬件][hardware]外设又具有很多灵活实用的功能，使其很容易嵌入各种工业应用场合，但功能丰富的同时也带来了系统开发尤其是驱动开发的复杂。

[^1]:LPC2300是NXP一款芯片

为了有效帮助工程师减少产品开发“0”阶段的时间，这里提供一种基于API方式操作底层硬件的开发方法。通过对LPC2300系列ARM片内外设寄存器的封装，生成一套用于LPC2300系列ARM的底层驱动库。

使用LPC2300==表格==开发，设计人员只需要调用API接口函数即可使用各种外设，无需理会其寄存器有多么复杂。通过封装的API函数，大大减少了与片内设备通信时所需的代码量。维护工作变得简单，驱动库使用了风格尽量统一的函数接口，使得程序的可移植性也大大提高。

|          | 使用驱动库 | 自行开发驱动 |
| -------- | ---------- | ------------ |
| 开发周期 | 短         | 长           |
| 代码量   | 小         | 大           |
| 维护工作 | 简单       | 复杂         |
| 移植     | 方便       | 难度大       |
| 开发难度 | 低         | 高           |

### 2.1.1 概述

ZLG/Driver2300驱动函数库配合LPC2300系列ARM使用，为用户提供了大部分片内外设的底层硬件驱动程序，但不包括USB、SD接口等，支持的常用部件如表1.2所示。

|      | 外设名称   | 说明                                                         |
| ---: | ---------- | ------------------------------------------------------------ |
|    1 | GPIO       | 支持全部P0、P1、P2、P3、P4端口，支持高速GPIO或低速GPIO操作。 |
|    2 | 中断控制器 | 在特权模式统一管理中断，提供FIQ、IRQ的所有中断设置接口       |
|    3 | 定时器     | 提供定时、计数、捕获外部事件、匹配输出等功能，当事件发生时均可以对是否产生中断、复位或停止TC等操作进行组合配置 |
|    4 | PWM        | 6路单边沿或3路双边沿PWM波输出，PWM控制器可作为定时器使用     |

另外，USB、SD接口等提供专门的软件包支持。使用驱动库函数，工程师不必关心硬件细节，只要懂C语言就可直接通过API函数操作LPC2300系列ARM开发产品，下面是==注解==。

>   本函数库可在LPC2300系列ARM的多种开发平台上使用，本章示范例程以SmartARM2300开发板为平台（MiniARM M23A模块）进行测试。暂时不支持其它硬件平台的应用，后续版本将对不同平台进行测试以解决平台兼容问题

### 2.1.2 特性

开发高效率、性能稳定的驱动程序，不仅要求工程师具有良好的程序编写水平，同时还要求对底层硬件接口技术非常熟悉。在面对一大堆的寄存器说明时，往往使很多平时专注于应用程序开发的工程师对于嵌入式系统望而却步。即使是有过底层开发经验的程序员，也往往希望能够有更轻松的开发方式出现，以减少其浪费在驱动程序编写上的时间==无序列表==。

-   标准C语言编程；

-   统一、简洁的系统硬件标准操作函数接口，使用Init()、SetMode()、Read()、Write()、Start()、Stop()完成各个外设的功能操作；

-   简单、清晰的VIC和引脚管理方式；

-   字符串参数处理

### 2.1.3  函数接口

使用ZLG/Driver2300驱动库开发产品时，程序员不必关注底层硬件的寄存器及其操作，直接在应用层调用API驱动函数即可使用UART、I²C等外设接口。
1. **设备区分**

对于相同的设备，如UART0、UART1，使用统一的函数接口，通过使用不同的ID号区分。在使用ID区分设备时，首先必须对相应设备进行宏定义（本驱动库已经完成），其例程如==代码==清单1.1所示。

```c
//初始化字符串参数，未写出的参数为默认值或无效
char UartArg[66] = "BaudRate=9600 RxBufSize=50 TxBufSize=50";

//初始化UART0								
UartInit(UART0, UartArg, NULL);			
```
2．**参数设置**

设备参数使用字符串方式传入，可以选择只输入部分参数，这时未输入的参数将被设置为默认值或被忽略。在书写字符串内容时候，必须特别注意其格式，非法的格式将被滤除，==上标==O<sup>2</sup>，==下标==H<sub>2</sub>O，也可以改变字体的颜色$ \color{green}{绿色}$。

- 字符串条目采用“关键字=数值”的格式；
- 条目作为一个基本的参数单数，内部不允许再包含空格等其他任何非法字符；
- 每个条目之间使用空格区分；
- 参数值支持十进制、十六进制（0xMN）、八进制（0MN），不能使用宏定义；
- 条目之间可用连接符“＼”实现跨行书写。

3. **添加图片**

除GPIO与VIC以外，添加的==图片==驱动库尽量使用统一的函数接口来操作底层硬件，所有设备均使用对应的Init()操作完成初始化工作，如TimerInit()、SspInit()、UartInit()等，初始化函数说明如表1.3所示，还可以添加==高亮的文字==，也可以添加==表情==:smile:。

![这是我添加的图片](https://github.com/mem222/public_note/raw/master/picture.png "这是图片提示信息")

4.  **添加分割线**

嵌入式系统中硬件与软件是一个有机的结合体，驱动程序是软硬件协调的交点，也是任何嵌入式系统中最重要的组成部分之一，底层驱动程序的可靠性直接影响到系统的运行效率和稳定性，==分割线==如下所示：

---

嵌入式系统中硬件与软件是一个有机的结合体，驱动程序是软硬件协调的交点，也是**粗体**任何嵌入式系统中最重要的组成部分之一，底层驱动程序的==删除线==直接~~影响到~~系统的运行效率和稳定性，或者面临==下划线==的<u>表示</u>。

也可以添加完成==任务完成结果==，如下面的表示。

-   [ ] 吃饭

-   [x] 睡觉

-   [ ] 上厕所

==代码高亮提示==: `npm install marked`















